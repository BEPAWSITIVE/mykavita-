<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prarambh Studio - Poetry Manager</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js" type="module"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js" type="module"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js" type="module"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: linear-gradient(to bottom, #1E90FF, #ffffff);
      color: #1C1C1C;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 20px;
      background: #1C1C1C;
      color: white;
    }
    header img { height: 50px; }

    .user-menu { position: relative; display: inline-block; }
    .user-icon {
      width: 40px; height: 40px; border-radius: 50%;
      background: #FF4500; color: white;
      display: flex; align-items: center; justify-content: center;
      font-weight: bold; cursor: pointer; overflow: hidden;
    }
    .user-icon img { width: 100%; height: 100%; border-radius: 50%; }
    .dropdown { display: none; position: absolute; right: 0; background: white; box-shadow: 0 4px 10px rgba(0,0,0,0.2); border-radius: 8px; overflow: hidden; z-index: 10; }
    .dropdown button { display: block; width: 100%; border: none; padding: 10px 20px; background: white; cursor: pointer; }
    .dropdown button:hover { background: #f0f0f0; }
    .user-menu:hover .dropdown { display: block; }

    #login-page {
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      height: 100vh;
    }
    #login-page img { width: 200px; margin-bottom: 20px; }
    #login-btn {
      background: linear-gradient(45deg, #FF4500, #FF6347);
      color: white; border: none; padding: 12px 20px;
      font-size: 16px; border-radius: 8px; cursor: pointer;
    }

    #main-page { display: none; flex: 1; flex-direction: column; }
    .top-bar {
      display: flex; justify-content: flex-end; align-items: center;
      gap: 10px; padding: 10px 20px; background: #f9f9f9; border-bottom: 2px solid #eee;
    }
    .search-bar { width: 200px; padding: 8px; border: 2px solid #1E90FF; border-radius: 20px; font-size: 14px; }
    .btn {
      background: linear-gradient(45deg, #FF4500, #FF6347);
      color: white; border: none; padding: 8px 14px; border-radius: 8px;
      cursor: pointer; font-size: 14px; transition: 0.3s;
    }
    #add-poem-btn { display: none; }

    .content { flex: 1; padding: 20px; }

    /* Compact poem card */
    .poem-card {
      background: white;
      border: 2px solid #FF6347;
      border-radius: 10px;
      padding: 8px 12px;
      margin-bottom: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      font-size: 13px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }
    .poem-card-content {
      flex: 1;
    }
    .poem-card-content h4 {
      margin: 0 0 4px 0;
      font-size: 14px;
      font-weight: bold;
    }
    .poem-card-content p {
      margin: 0;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .poem-card-buttons {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-left: 10px;
    }
    .poem-card-buttons button {
      font-size: 12px;
      padding: 2px 6px;
      border-radius: 6px;
      background: linear-gradient(45deg, #FF4500, #FF6347);
      color: white;
      border: none;
      cursor: pointer;
    }
    .poem-card-buttons button:hover { opacity: 0.9; }

    footer {
      text-align: center; padding: 20px;
      background: #1C1C1C; color: white; margin-top: auto;
    }
    footer img { height: 60px; display: block; margin: 0 auto 10px auto; }

    .modal {
      display: none; position: fixed; z-index: 20; left: 0; top: 0;
      width: 100%; height: 100%; background: rgba(0,0,0,0.6);
      display: flex; align-items: center; justify-content: center;
    }
    .modal-content {
      background: white; padding: 20px; border-radius: 12px;
      width: 90%; max-width: 400px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.3);
      animation: fadeIn 0.3s ease;
    }
    .modal input, .modal textarea {
      width: 100%; padding: 10px; border: 2px solid #1E90FF; border-radius: 8px;
      margin-bottom: 12px; font-size: 14px;
    }
    .modal textarea { height: 120px; resize: none; }
    @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
  </style>
</head>
<body>

  <!-- Login Page -->
  <div id="login-page">
    <img src="studio_logo.png" alt="Prarambh Studio Logo">
    <h2>Welcome to Prarambh Studio</h2>
    <button id="login-btn">Login with Google</button>
  </div>

  <!-- Main Page -->
  <div id="main-page">
    <header>
      <img src="studio_logo.png" alt="Logo">
      <div class="user-menu">
        <div class="user-icon" id="user-icon">U</div>
        <div class="dropdown">
          <button id="logout-btn">Logout</button>
          <button id="switch-btn">Switch User</button>
        </div>
      </div>
    </header>

    <div class="top-bar">
      <input type="text" id="search" class="search-bar" placeholder="Search...">
      <button class="btn" id="add-poem-btn">Add Poem</button>
    </div>

    <div class="content">
      <div id="poems-list"></div>
    </div>

    <footer>
      <img src="studio_logo.png" alt="Logo">
      <p>Prarambh Studio | Open Mic Show</p>
    </footer>
  </div>

  <!-- Add/Edit/View Poem Modal -->
  <div class="modal" id="poem-modal">
    <div class="modal-content">
      <h3 id="modal-title">Add / Edit Poem</h3>
      <input type="text" id="poem-title" placeholder="Title of poetry">
      <textarea id="poem-text" placeholder="Write full poetry here..."></textarea>
      <button class="btn" id="save-poem-btn">Save</button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, setDoc, deleteDoc, query, where, onSnapshot, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "enter your api key here",
      authDomain: "poetry-management.firebaseapp.com",
      projectId: "poetry-management",
      storageBucket: "poetry-management.firebasestorage.app",
      messagingSenderId: "594540553495",
      appId: "1:594540553495:web:03582f4b68ec4643918352"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const loginPage = document.getElementById('login-page');
    const mainPage = document.getElementById('main-page');
    const loginBtn = document.getElementById('login-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const switchBtn = document.getElementById('switch-btn');
    const poemsList = document.getElementById('poems-list');
    const searchInput = document.getElementById('search');
    const userIcon = document.getElementById('user-icon');
    const addPoemBtn = document.getElementById('add-poem-btn');
    const modal = document.getElementById('poem-modal');
    const modalTitle = document.getElementById('modal-title');
    const savePoemBtn = document.getElementById('save-poem-btn');
    const poemTitle = document.getElementById('poem-title');
    const poemText = document.getElementById('poem-text');

    let currentUser = null;

    addPoemBtn.style.display = 'none';
    modal.style.display = 'none';

    onAuthStateChanged(auth, (user) => {
      currentUser = user;
      if (user) {
        loginPage.style.display = 'none';
        mainPage.style.display = 'flex';
        addPoemBtn.style.display = 'inline-block';
        userIcon.innerHTML = currentUser.photoURL ? `<img src="${currentUser.photoURL}" alt="User">` : currentUser.displayName ? currentUser.displayName[0] : "U";
        loadPoems();
      } else {
        loginPage.style.display = 'flex';
        mainPage.style.display = 'none';
        addPoemBtn.style.display = 'none';
      }
    });

    loginBtn.addEventListener('click', async () => {
      const provider = new GoogleAuthProvider();
      try { await signInWithPopup(auth, provider); }
      catch (err) { alert("Login failed: " + err.message); }
    });

    logoutBtn.addEventListener('click', async () => { await signOut(auth); });
    switchBtn.addEventListener('click', async () => { await signOut(auth); });

    addPoemBtn.addEventListener('click', () => {
      modalTitle.textContent = "Add Poem";
      modal.style.display = 'flex';
      poemTitle.value = "";
      poemText.value = "";
      savePoemBtn.style.display = "inline-block";
      savePoemBtn.onclick = saveNewPoem;
    });

    function saveNewPoem() {
      const title = poemTitle.value.trim();
      const text = poemText.value.trim();
      if (title && text && currentUser) {
        addDoc(collection(db, "poems"), {
          userId: currentUser.uid,
          title: title,
          text: text,
          createdAt: serverTimestamp()
        });
        modal.style.display = 'none';
      } else { alert("Please fill all fields."); }
    }

    modal.addEventListener('click', (e) => { if (e.target === modal) modal.style.display = 'none'; });

    function loadPoems() {
      if (!currentUser) return;
      const q = query(
        collection(db, "poems"),
        where("userId", "==", currentUser.uid),
        orderBy("createdAt", "desc")
      );
      onSnapshot(q, (snapshot) => {
        poemsList.innerHTML = "";
        snapshot.forEach((docSnap) => {
          const poem = docSnap.data();
          const lines = poem.text.split('\n');
          const shortText = lines.slice(0, 2).join(' ');

          const card = document.createElement('div');
          card.className = 'poem-card';
          card.innerHTML = `
            <div class="poem-card-content">
              <h4>${poem.title || "Untitled"}</h4>
              <p>${shortText}</p>
            </div>
            <div class="poem-card-buttons">
              <button class="btn-view">View</button>
              <button class="btn-edit">Edit</button>
              <button class="btn-delete">Delete</button>
            </div>
          `;

          card.querySelector('.btn-view').addEventListener('click', () => {
            modalTitle.textContent = poem.title || "Untitled";
            poemTitle.value = poem.title;
            poemText.value = poem.text;
            savePoemBtn.style.display = "none";
            modal.style.display = 'flex';
          });

          card.querySelector('.btn-delete').addEventListener('click', async () => {
            if (confirm("Are you sure you want to delete this poem?")) {
              await deleteDoc(docSnap.ref);
            }
          });

          card.querySelector('.btn-edit').addEventListener('click', () => {
            modalTitle.textContent = "Edit Poem";
            poemTitle.value = poem.title;
            poemText.value = poem.text;
            savePoemBtn.style.display = "inline-block";
            modal.style.display = 'flex';
            savePoemBtn.onclick = async () => {
              const newTitle = poemTitle.value.trim();
              const newText = poemText.value.trim();
              if (newTitle && newText) {
                await setDoc(docSnap.ref, {
                  userId: currentUser.uid,
                  title: newTitle,
                  text: newText,
                  createdAt: serverTimestamp()
                });
                modal.style.display = 'none';
              } else { alert("Please fill all fields."); }
            };
          });

          poemsList.appendChild(card);
        });
      });
    }

    searchInput.addEventListener('input', () => {
      const queryText = searchInput.value.toLowerCase();
      const cards = document.querySelectorAll('.poem-card');
      cards.forEach(card => {
        card.style.display = card.textContent.toLowerCase().includes(queryText) ? "flex" : "none";
      });
    });
  </script>
</body>
</html>

